<style>
    .top {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 18px;
        align-items: stretch;
        margin-bottom: 8px;
        height: 200px;
    }

    .left {
        display: flex;
        flex-direction: column;
        margin-right: 32px;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .avatar-wrap {
        width: 100%;
        display: flex;
        justify-content: center;
    }

    .avatar {
        width: 150px;
        height: 150px;
        border-radius: 12px;
        display: block;
    }

    #achievements {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: center;
        width: 100%;
    }

    #achievements img {
        width: 40px;
        height: 40px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        column-gap: 34px;
        row-gap: 12px;
        align-content: center;
    }

    .stat {
        padding-left: 10px;
        border-left: 6px solid #bdbdbd;
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .stat .value {
        font-size: 22px;
        font-weight: 800;
    }

    .stat .label {
        font-size: 12px;
        font-weight: 200;
    }

    #gh_months {
        display: flex;
        flex-direction: row;
        gap: 8px;
        align-items: flex-start;
        margin-top: 6px;
    }

    .month-block {
        display: flex;
        flex-direction: column;
        gap: 3px;
    }

    .month-title {
        font-size: 9px;
    }

    .month-grid {
        display: grid;
        grid-template-rows: repeat(7, 9px);
        grid-auto-flow: column;
        grid-auto-columns: 9px;
        gap: 2px;
    }

    .day {
        width: 9px;
        height: 9px;
        border-radius: 2px;
    }
</style>

<div class="layout layout--col gap--space-between">

    <div class="top">
        <div class="left">
            <div class="avatar-wrap">
                <img class="avatar image-dither" src="{{ IDX_0.data.user.avatarUrl }}">
            </div>
            <div id="achievements"></div>
        </div>

        <div class="stats-grid">
            <div class="stat">
                <div id="total" class="value"></div>
                <div class="label">Total</div>
            </div>
            <div class="stat">
                <div id="active" class="value"></div>
                <div class="label">Active days</div>
            </div>
            <div class="stat">
                <div id="avg" class="value"></div>
                <div class="label">Avg active</div>
            </div>

            <div class="stat">
                <div id="current" class="value"></div>
                <div class="label">Current streak</div>
            </div>
            <div class="stat">
                <div id="longest" class="value"></div>
                <div class="label">Longest streak</div>
            </div>
            <div class="stat">
                <div id="bestday" class="value"></div>
                <div class="label">Best day</div>
            </div>

            <div class="stat">
                <div id="bestmonth" class="value"></div>
                <div class="label">Best month</div>
            </div>
            <div class="stat">
                <div id="bestweekday" class="value"></div>
                <div class="label">Best weekday</div>
            </div>
            <div class="stat">
                <div id="maxday" class="value"></div>
                <div class="label">Max in a day</div>
            </div>
        </div>
    </div>

    <div id="gh_months"></div>

</div>

<div class="title_bar">
    <span class="title">GitHub</span>
    <span class="instance">{{ IDX_0.data.user.name }}</span>
</div>

<script>
    const weeks = {{ IDX_0.data.user.contributionsCollection.contributionCalendar.weeks | json }};
    const root = document.getElementById('gh_months');

    const days = [];
    weeks.forEach(w => w.contributionDays.forEach(d => days.push(d)));

    const calendar = {};
    days.forEach(d => {
        const dt = new Date(d.date);
        dt.setHours(0, 0, 0, 0);
        const ts = Math.floor(dt.getTime() / 1000);
        calendar[ts] = d.contributionCount;
    });

    const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    const weekdayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

    let total = 0, activeDays = 0, longest = 0, current = 0, streak = 0;
    let maxDay = 0, bestDay = null;

    const weekdaySum = Array(7).fill(0);
    const monthSum = Array(12).fill(0);

    days.forEach(d => {
        const c = d.contributionCount;
        total += c;

        const date = new Date(d.date);
        weekdaySum[date.getDay()] += c;
        monthSum[date.getMonth()] += c;

        if (c > 0) {
            activeDays++;
            streak++;
            if (streak > longest) longest = streak;
        } else {
            streak = 0;
        }

        if (c > maxDay) {
            maxDay = c;
            bestDay = date;
        }
    });

    for (let i = days.length - 1; i >= 0; i--) {
        if (days[i].contributionCount > 0) current++;
        else break;
    }

    document.getElementById('total').textContent = total;
    document.getElementById('active').textContent = activeDays;
    document.getElementById('avg').textContent = (total / activeDays).toFixed(1);
    document.getElementById('current').textContent = current;
    document.getElementById('longest').textContent = longest;
    document.getElementById('maxday').textContent = maxDay;
    document.getElementById('bestday').textContent =
        monthNames[bestDay.getMonth()] + " " + bestDay.getDate();
    document.getElementById('bestmonth').textContent =
        monthNames[monthSum.indexOf(Math.max(...monthSum))];
    document.getElementById('bestweekday').textContent =
        weekdayNames[weekdaySum.indexOf(Math.max(...weekdaySum))];

    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const start = new Date(today.getFullYear(), today.getMonth() - 11, 1);

    for (let i = 0; i < 12; i++) {
        const year = start.getFullYear();
        const month = start.getMonth();

        const monthStart = new Date(year, month, 1);
        const monthEnd = new Date(year, month + 1, 0);

        const block = document.createElement('div');
        block.className = 'month-block';

        const title = document.createElement('div');
        title.className = 'month-title';
        title.textContent = monthNames[month];
        block.appendChild(title);

        const grid = document.createElement('div');
        grid.className = 'month-grid';

        for (let d = new Date(monthStart); d <= monthEnd; d.setDate(d.getDate() + 1)) {
            if (d > today) break;

            const dt = new Date(d);
            dt.setHours(0, 0, 0, 0);
            const ts = Math.floor(dt.getTime() / 1000);
            const count = calendar[ts] || 0;

            const cell = document.createElement('div');
            cell.className = 'day';

            if (count === 0) cell.classList.add('bg--gray-6');
            else if (count < 2) cell.classList.add('bg--gray-4');
            else if (count < 4) cell.classList.add('bg--gray-2');
            else cell.classList.add('bg--black');

            grid.appendChild(cell);
        }

        block.appendChild(grid);
        root.appendChild(block);
        start.setMonth(start.getMonth() + 1);
    }
</script>